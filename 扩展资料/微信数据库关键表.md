# 微信好友相关

## rcontact
### 功能 
rcontact表存放了该账号涉及的所有账号(微信账号，群账号)的基本信息(eg：微信昵称，备注，原微信号，改之后的微信号，全拼等等)
### 数据表结构 
```sql
CREATE TABLE rcontact (  username TEXT default ''  PRIMARY KEY ,  alias TEXT default '' ,  conRemark TEXT default '' ,  domainList TEXT default '' ,  nickname TEXT default '' ,  pyInitial TEXT default '' ,  quanPin TEXT default '' ,  showHead INTEGER default '0' ,  type INTEGER default '0' ,  uiType LONG default '0' ,  weiboFlag INTEGER default '0' ,  weiboNickname TEXT default '' ,  conRemarkPYFull TEXT default '' ,  conRemarkPYShort TEXT default '' ,  lvbuff BLOB,  verifyFlag INTEGER default '0' ,  encryptUsername TEXT default '' ,  chatroomFlag INTEGER,  deleteFlag INTEGER default '0' ,  contactLabelIds TEXT default '' ,  descWordingId TEXT default '' ,  openImAppid TEXT,  sourceExtInfo TEXT,  ticket TEXT default '' ,  usernameFlag LONG default '0' ,  contactExtra BLOB, createTime LONG default '0');
```

## bizinfo
### 功能
bizinfo表存放的是该账号的好友微信号，群账号，这里好友包括已经通过的和添加没通过的

### 数据表结构
```sql
CREATE TABLE bizinfo (  username TEXT PRIMARY KEY ,  appId TEXT,  brandList TEXT default '' ,  brandListVersion TEXT,  brandListContent TEXT,  brandFlag INTEGER,  extInfo TEXT,  brandInfo TEXT,  brandIconURL TEXT,  updateTime LONG,  hadAlert INTEGER,  acceptType INTEGER default '0' ,  type INTEGER default '0' ,  status INTEGER default '0' ,  enterpriseFather TEXT,  kfWorkerId TEXT,  specialType INTEGER,  attrSyncVersion TEXT,  incrementUpdateTime LONG,  bitFlag INTEGER default '0' );
```

## img_flag
### 功能
img_flag表存放该账号所有涉及的微信(好友，同属一个群不是好友，添加的陌生人)的头像地址，数据如下图所示：

### 数据表结构
```sql
CREATE TABLE img_flag ( username VARCHAR(40) PRIMARY KEY , imgflag int , lastupdatetime int , reserved1 text ,reserved2 text ,reserved3 int ,reserved4 int ,updateflag int default 0);
```


# 微信群组相关

## chatroom
### 功能
微信群组一开始建立显示群昵称是所有好友微信昵称加起来的一个字符串，即displayname字段，但是如果修改了群昵称之后，显示的是修改之后的，这时候需要根据根据群账号chatroomname去rcontact表做关联查询，根据rcontact表的username等于群账号查询出一条记录，此时这条记录的字段nickname即修改后的群昵称，查询sql如下：

```
select c.chatroomname, c.memberlist, c.displayname, c.roomowner, c.selfDisplayName, r.nickname from chatroom c inner join rcontact r on r.username = c.chatroomname where c.modifytime > 0
```


### 数据表结构
```sql

CREATE TABLE chatroom (  chatroomname TEXT default ''  PRIMARY KEY ,  addtime LONG,  memberlist TEXT,  displayname TEXT,  chatroomnick TEXT,  roomflag INTEGER,  roomowner TEXT,  roomdata BLOB,  isShowname INTEGER,  selfDisplayName TEXT,  style INTEGER,  chatroomdataflag INTEGER,  modifytime LONG,  chatroomnotice TEXT,  xmlChatroomnotice TEXT,  chatroomVersion INTEGER,  chatroomnoticeEditor TEXT,  chatroomnoticePublishTime LONG,  chatroomNoticeNew INTEGER,  chatroomLocalVersion LONG,  chatroomStatus INTEGER default '0' ,  memberCount INTEGER default '-1' ,  chatroomfamilystatusmodifytime LONG default '0' ,  associateOpenIMRoomName TEXT,  openIMRoomMigrateStatus INTEGER default '0' ,  saveByteVersion TEXT,  handleByteVersion TEXT,  roomInfoDetailResByte BLOB,  oldChatroomVersion INTEGER,  localChatRoomWatchMembers BLOB,  spamStatus INTEGER default '0' ,  compactFlag LONG default '0' );
```


# 聊天数据

## message
### 功能
msgSvrId：唯一标示一条聊天记录的id，可以作为更新聊天记录数据的条件
createTime：发送消息的时间
talker：如果是群账号，说明这条消息是群会话消息，发送人在content内容前面(发送人微信号：发送内容)；如果是好友微信号，说明这条消息是好友会话消息
isSend：发送或者接收标志。0：接收 1：发送
type：消息类型 1：文本内容(包括小表情) 3：图片 34：语音 43：视频 47：大表情 49：文件
436207665：微信红包 419430449：微信转账
图片，视频，语音， 文件 根据msgId去索引库WxFileIndex的表WxFileIndex2查询

### 数据表结构
```sql
CREATE TABLE message ( msgId INTEGER PRIMARY KEY, msgSvrId INTEGER , type INT, status INT, isSend INT, isShowTimer INTEGER, createTime INTEGER, talker TEXT, content TEXT, imgPath TEXT, reserved TEXT, lvbuffer BLOB, transContent TEXT,transBrandWording TEXT ,talkerId INTEGER, bizClientMsgId TEXT, bizChatId INTEGER DEFAULT -1, bizChatUserId TEXT, msgSeq INTEGER, flag INT, solitaireFoldInfo BLOB, historyId TEXT);
```
